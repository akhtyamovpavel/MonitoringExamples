# Примеры мониторинга и сбора метрик

Этот репозиторий содержит примеры различных подходов к сбору и визуализации метрик в системах мониторинга. Проект демонстрирует интеграцию нескольких популярных инструментов мониторинга и сбора метрик.

## Компоненты системы

### Системы сбора метрик
1. **Prometheus** - система мониторинга и сбора метрик с временными рядами
   - Доступен на порту 9090
   - Использует node-exporter для сбора системных метрик
   - Имеет собственный worker для сбора пользовательских метрик
   - **Worker Prometheus** ([`worker-prometheus/run.py`](worker-prometheus/run.py)):
     - Собирает данные о ценах акций с Московской биржи (MOEX)
     - Отслеживает акции: SBERP, SBER, GAZP
     - Использует гистограммы для агрегации данных
     - Обновляет метрики каждые 30 секунд
     - Предоставляет HTTP-эндпоинт на порту 8000

2. **Graphite** - система сбора и хранения временных рядов
   - Доступен на порту 18000
   - Включает StatsD для сбора метрик
   - Имеет выделенный worker для обработки данных
   - **Graphite/InfluxDB Scraper** ([`run.py`](run.py)):
     - Собирает те же данные о ценах акций с MOEX
     - Отправляет метрики в Graphite с префиксом 'stocks'
     - Дублирует данные в InfluxDB с тегами и измерениями
     - Использует структурированный формат для InfluxDB

3. **InfluxDB** - база данных временных рядов
   - Доступна на порту 8086
   - База данных: pyexample
   - Получает данные от общего скраппера с Graphite
   - Хранит структурированные метрики с тегами

### Визуализация
- **Grafana** - платформа для визуализации метрик
  - Доступна на порту 3000
  - Интегрирована с Prometheus, Graphite и InfluxDB
  - Включает дополнительные плагины для расширенной функциональности

### Бэкенд
- **Backend Service** - сервис на порту 8998
- **Worker Prometheus** - сервис на порту 28000

## Структура репозитория

- [`backend/`](backend/) - исходный код бэкенд-сервиса
- [`prometheus/`](prometheus/) - конфигурация Prometheus
- [`worker-prometheus/`](worker-prometheus/) - код worker'а для Prometheus
  - [`run.py`](worker-prometheus/run.py) - скрипт сбора метрик для Prometheus
- [`Dockerfile`](Dockerfile) - базовый Dockerfile для сборки образов
- [`docker-compose.yml`](docker-compose.yml) - конфигурация всех сервисов
- [`install-node-exporter.sh`](install-node-exporter.sh) - скрипт установки node-exporter
- [`run.py`](run.py) - скрипт сбора метрик для Graphite и InfluxDB
- [`runner.sh`](runner.sh) - вспомогательный скрипт запуска
- [`wait-for-grid.sh`](wait-for-grid.sh) - скрипт ожидания готовности сетки

## Запуск проекта

1. Убедитесь, что у вас установлен Docker и Docker Compose
2. Запустите все сервисы:
```bash
docker-compose up -d
```

## Доступ к сервисам

- Grafana: http://localhost:3000
- Prometheus: http://localhost:9090
- Graphite: http://localhost:18000
- InfluxDB: http://localhost:8086
- Backend: http://localhost:8998
- Worker Prometheus: http://localhost:28000

## Сети

Проект использует несколько Docker-сетей для изоляции компонентов:
- `frontend` - для сервисов, доступных извне
- `backend` - для внутренних сервисов
- `browsers` - для сервисов, связанных с браузерами
- `prometheus` - для компонентов системы мониторинга 